/**
 * Author : A.Lepe (dev@alepe.com)
 * License: MIT
 * Version: 0.1.8
 * Updated: 2024-12-11
 * Content: ndjson-ui.min.js (Minimized)
 */

class NDJPlayer{player;options;ui;constructor(e,t,n){const a=this;function s(e){return e.indexOf(".")>0||-1!==e.indexOf("/")}function o(e){return"."===e[0]||"#"===e[0]||null!==document.querySelector(e)}switch(arguments.length){case 2:"Object"===arguments[1].constructor.name&&(n=arguments[1],s(arguments[0])?t=null:(arguments[0]instanceof HTMLElement||o(arguments[0]))&&(t=arguments[0],e=null));break;case 1:switch(!0){case"Object"===arguments[0].constructor.name:n=arguments[0],e=null,t=null;break;case s(arguments[0]):e=arguments[0],t=null,n={};break;case arguments[0]instanceof HTMLElement||o(arguments[0]):t=arguments[0],e=null,n={};break;default:console.log("Unknown parameter was passed to NDJPlayer constructor."),e=null,t=null,n={}}break;case 0:n={}}a.options=Object.assign({controls:!1,resize:!0,onaction:(e,t,n)=>{},onplay:e=>{},onstop:e=>{}},n||{}),this._create(t),this.player=new NdJsonPlayer(e,t,a.options,{onstart:function(e){a._adjustSize(),void 0!==a.options.onstart&&a.options.onstart(e)},onload:function(e){void 0!==a.options.onload&&a.options.onload(e)},onrender:function(e){a._onUpdate(e),void 0!==a.options.onrender&&a.options.onrender(e)},onplay:function(e){a.ui.panel&&(a.ui.play.show=!1,a.ui.step.css.contains("disabled")||(a.ui.step.show=!1),a.ui.pause.show=!0),a.options.onplay(e)},onstop:function(e){a.ui.panel&&(a.ui.play.show=!0,a.ui.step.css.contains("disabled")||(a.ui.step.show=!0),a.ui.pause.show=!1),a.options.onstop(e)},onfinish:function(e){},onerror:function(e){console.log(e)}}),window.addEventListener("resize",(function(e){a._adjustSize()}),!0)}_onUpdate(e){const t=this;if(t.ui){if(t.ui.frames&&(t.ui.frames.text=t.player.currentFrame()+1+"/"+t.player.totalFrames()),t.ui.lapse){let n="";const a=t.player._startTimeStamp&&void 0!==e.ts,s=void 0!==e.t,o=t.player._totTime>0;e.d&&(n=e.d+" "),a?n+=t._formatMillis(e.ts-t.player._startTimeStamp):s&&(n+=e.t.indexOf(":")>0?e.t:t._fmtTime(e.t)),o&&(n+="/"+t.player.totalTime()),t.ui.lapse.text=n}t.ui.progress&&t.player.totalFrames()&&(t.ui.progress.value=Math.round((t.player.currentFrame()+1)/t.player.totalFrames()*100))}}_adjustSize(){if(this.options.resize){let e=this.player.wrapper,t=e.parent(),n=(this.options.height||this.player.canvas.height)/(this.options.width||this.player.canvas.width);this.player.canvas.height=t.clientHeight-(this.options.controls?e.querySelector(".panel").clientHeight:0),this.player.canvas.width=this.player.canvas.height/n}}_create(e){const t=this;if(m2d2){const n=m2d2.load();t.ui=n(e,t._getUI(e)),t.ui.panel&&["thumb","play","step","pause","stop","lapse","progress","frames","fullscreen"].forEach((e=>{t.ui[e]=t.ui.panel[e]}))}else console.log("M2D2 was not found. Either use the standard version (which includes M2D2) or add M2D2 in your dependencies.")}_getUI(e){const t=this;let n={html:e.innerHTML||""};if(t.options.controls&&(n=this._getBasicUI(),"full"===t.options.controls))n.panel.step.css.remove("disabled");this.options.controls;let a=e instanceof Node?e:document.querySelector(e);if(a){a.querySelector("canvas")||(n=Object.assign({canvas:""},n))}else console.log("Root element: "+e+" was not found in document"),n=Object.assign({canvas:""},n);return n}_getBasicUI(){const e=this;return document.addEventListener("fullscreenchange",(t=>{const n=e.player.wrapper;document.fullscreenElement?n.classList.add("fullscreen"):n.classList.remove("fullscreen")})),{caption:"",css:e.options.controls,panel:{tagName:"div",className:"panel",thumb:{tagName:"figure",className:"thumb",img:{src:""},caption:{tagName:"figCaption",className:"caption"}},rec:{tagName:"a",className:"rec",title:"Live",href:"#"},play:{tagName:"a",className:"play",title:"Play",href:"#",onclick:function(){return e.ui.onaction("play",e.player,e),e.player.play(),!1}},pause:{tagName:"a",className:"pause",title:"Pause",href:"#",onclick:function(){return e.ui.onaction("pause",e.player,e),e.player.pause(),!1}},step:{tagName:"a",css:["step","disabled"],title:"Step",href:"#",onclick:function(){return e.ui.onaction("step",e.player,e),e.player.step(),!1}},stop:{tagName:"a",className:"stop",title:"Stop",href:"#",onclick:function(){return e.ui.onaction("stop",e.player,e),e.player.stop(),!1}},lapse:{tagName:"label",className:"lapse",title:"Time elapsed / Time Total",text:"0:00"},live:{tagName:"label",className:"live",text:"Live Feed"},progress:{value:0,max:100,onmousemove:function(t){let n=~~(t.offsetX/this.offsetWidth*100),a=e.player.frameAt(e.player.indexAt(n));a?(e.ui.thumb.show=!0,e.ui.thumb.img.src=(e.player.thumbBase()||e.player.frameBase())+(a.th||a.f),e.ui.thumb.img.onload=function(){const t=e.ui.thumb.img.naturalWidth||e.ui.thumb.img.width;e.ui.thumb.style.width=t+"px"},void 0!==a.tc&&(e.ui.thumb.caption=a.tc),e.ui.thumb.style.left=this.offsetLeft+t.offsetX-e.ui.thumb.clientWidth/2+"px"):e.ui.thumb.show=!1},onmouseleave:function(){e.ui.thumb.show=!1},onclick:function(t){let n=~~(t.offsetX/this.offsetWidth*100),a=e.player.indexAt(n);e.player.jumpTo(a),e.ui.onaction("progress",e.player,e)}},frames:{tagName:"label",className:"frames",title:"Current Frame / Total Frames",text:"0"},fullscreen:{tagName:"a",className:"fullscreen",title:"Full Screen",href:"#",onclick:function(t){const n=e.player.wrapper;return n.classList.contains("fullscreen")?(e.ui.onaction("exit-fullscreen",e.player,e),document.exitFullscreen()):(e.ui.onaction("fullscreen",e.player,e),n.requestFullscreen()),!1}}},onaction:function(t,n,a){e.options.onaction(t,n,a)},onplay:function(t){e.options.onplay(t)},onstop:function(t){e.options.onstop(t,uiPlayer)}}}_fmtTime(e){let t=(e=e.toFixed(2)).split(".")[1]||"00";return(~~(e/60)+"").padStart(2,"0")+":"+(~~(e/60%1*60)+"").padStart(2,"0")+"."+t}_formatMillis(e){function t(e,t){return("00"+e).slice(-1*(t||2))}const n=Math.floor(e/1e3/60/60),a=Math.floor(60*(e/1e3/60/60-n)),s=Math.floor(60*(60*(e/1e3/60/60-n)-a)),o=parseInt(e%1e3/100);return t(n)+":"+t(a)+":"+t(s)+"."+t(o,3)}}
//# sourceMappingURL=ndjson-ui.min.js.map
