"use strict";class Utils{static htmlNode(t){const e=Utils.newNode("template");return e.innerHTML=t.trim(),e.content.firstChild}static newNode(t){return document.createElement(t)}static node(t,e){return void 0===e&&(e=document),t instanceof Node?t:e.querySelector(t)}static isNumeric(t){return!isNaN(parseFloat(t))&&isFinite(t)}static isSelectorID(t){return 0===(t+"").trim().indexOf("#")}static isPlainObject(t){return Utils.isObject(t)&&!Utils.isArray(t)}static isObject(t){return"object"==typeof t}static isArray(t){return Array.isArray(t)}static isFunction(t){return"function"==typeof t}static isHtml(t){return-1!==(t+"").trim().indexOf("<")}static isEmpty(t){return void 0===t||Utils.isObject(t)&&0===Object.keys(t).length||""===t}}class M2D2{root;constructor(t){this.root=t.root||"body",this.template=t.template||{},this.data=t.data||[],this._init()}static _ext={};static extend(t){Object.assign(M2D2._ext,t)}update(t,e,i){const o=this;if(o._rendered){const n=function(t){let n;if(void 0!==t._node)if(Utils.isArray(t))if(void 0===i)void 0!==t[e]._node&&t[e]._node.remove();else{let e;const i=[];for(e in t._node.childNodes)n=t._node.childNodes[e],n&&void 0!==n.tagName&&"TEMPLATE"!==n.tagName&&i.push(n);for(e in i)n=i[e],n.remove();o._doRender(t._node,t)}else{const n={};n[e]=i.value,"items"!==e||void 0===t.template||Utils.isEmpty(t.template)||(n.template=t.template),o._doRender(t._node,n)}else o._doRender(o.$root,t)};void 0===e&&Utils.isFunction(o._func)?o._doFunc(o._func,t,(function(t){n(t)})):n(t)}}get(){return this._defineProp(this._data,"m2d2",this),this._setProxy(),this._data}clear(){const t=this;t._rendered&&(t.$root.innerHTML=t._cache)}$root=null;_rendered=!1;_updater=!0;_cache=null;_data=null;_func=null;_htmlGenTags=["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","map","mark","menu","meter","nav","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","samp","section","select","small","span","strong","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","tr","tt","ul","var"];_init(){const t=this;if(Utils.isFunction(t._data)){t._func=t._data;let e=t._doFunc(t._func,t.param);e&&(Utils.isArray(e)&&(e={items:e}),t._data=e,t._rendered||t._onReady())}else Utils.isObject(t._data)||(t._data={text:t._data}),t._onReady()}_render(){const t=this;if(void 0===t._data)return console.log("data is missing in m2d2 object with root: "+t.root),!1;t._doRender(t.$root,t._data),t._rendered=!0}_onReady(){const t=this;t.$root=Utils.node(t.root),t.$root?(t._cache=t.$root.innerHTML,t._render()):console.log("Warning: Node was not found: "+t.root)}_doFunc(t,e,i){const o=this;let n=t((function(t,e,n){let s,l=void 0!==o._data._proxy;if(void 0!==n&&Utils.isNumeric(n)?s=n:void 0!==e&&Utils.isNumeric(e)&&(s=e),Utils.isArray(t)){const i={};void 0===e||Utils.isNumeric(e)?void 0!==o.template&&(i.template=o.template):i.template=e,i.items=t,t=i}if(Utils.isPlainObject(t)){o._updater=!1,l||(o._data={});for(let e in t)o._data[e]=t[e];o._updater=!0}if(void 0===s&&o.interval>0&&(s=o.interval),s>0){const t=function(){o._func((function(t){o._doRender(o.$root,t)}))};o.interval=setInterval(t,s)}o._onReady(),void 0!==i&&i(t)}),e)||{};return Utils.isFunction(o._data)||(n=o._data),Utils.isArray(n)&&(n={items:n}),Utils.isObject(n)||console.log("Undefined type of 'data'. For automatic detection do not set any 'return' in the data's function. Or explicitly return '[]' for arrays or '{}' for objects."),n}_setProxy(){const t=this;void 0===t._data._proxy&&(Utils.isPlainObject(t._data)||Utils.isArray(t._data))&&(t._data=t._proxy(t._data,(function(e,i,o){"m2d2"!==i&&"_"!==i[0]&&t._updater&&t.update(e,i,o)})))}_doRender(t,e,i){void 0===i&&(i=!1),e&&void 0!==e.oninit&&Utils.isFunction(e.oninit)&&(e.oninit(),delete e.oninit),Utils.isArray(e)&&(e={items:e}),this._setProxy(),this._setValues(t,e,i),e&&void 0!==e.onrender&&Utils.isFunction(e.onrender)&&(e.onrender(),delete e.onrender)}_doArray(t,e,i,o){const n=this;void 0===o&&(o=!1),n._setNode(t,i);let s=n._getTemplate(t,e);for(let l=0;l<(i.length||Object.keys(i).length);l++){let a=i[l]||Object.values(i)[l];if(void 0!==a._node&&(a._node=void 0),!s)if("SELECT"===t.tagName||"DATALIST"===t.tagName)s="<option>","string"==typeof a&&(a={text:a,value:a});else if("UL"===t.tagName||"OL"===t.tagName)s="<li>";else if("NAV"===t.tagName)s="<a>";else{if(!Utils.isPlainObject(a))return console.log("Warning: No template found for object:"),console.log(t),void console.log(e);if(1!==Object.keys(a).length)return console.log("Warning: Multiple keys in data without template is not supported yet. Object:"),void console.log(e);if(Utils.isSelectorID(a)){const t=document.querySelector(a);if(!t)return console.log("Warning: ID selector for template not found: "+a+" . Object:"),void console.log(e);s=t.outerHTML}else s=Utils.newNode(Object.keys(a)[0]).outerHTML}const r=Utils.htmlNode(s);r.setAttribute("data-id",l),t.append(r),n._setValues(r,a,o)}}_getTemplate(t,e){const i=this;if(void 0!==e._template&&""!==e._template)return e._template;{let o;if(void 0!==e.template?Utils.isPlainObject(e.template)?(o=Utils.newNode("div"),i._setValues(o,e.template,!0)):o=Utils.isSelectorID(e.template)?document.querySelector(e.template):Utils.isHtml(e.template)?Utils.htmlNode("<template>"+e.template+"</template>"):Utils.htmlNode("<template>"+Utils.newNode(e.template).outerHTML+"</template>"):o=Utils.node("template",t),o){const t=o.innerHTML.trim();return i._defineProp(e,"_template",t),t}return t.innerHTML.trim()}}_setValues(t,e,i){const o=this;if(void 0===i&&(i=!1),Utils.isArray(e)&&(e={items:e}),Utils.isPlainObject(e)){o._setNode(t,e),e.hasOwnProperty("html")&&null!==e.html&&o._setValue(t,"html",e.html),e.hasOwnProperty("template")&&(t.append(Utils.htmlNode("<template>"+o._getTemplate(t,e)+"</template>")),e.hasOwnProperty("items")||(e.items=[]));for(let n in e){const s=e[n];if("html"===n||"template"===n||n.startsWith("_"));else if("items"===n)o._doArray(t,e,s,i);else if("items"!==n||Utils.isArray(s)||(console.log("Warning: 'items' specified but value is not and array in element: "),console.log(t),console.log("Passed values are: "),console.log(s)),void 0!==M2D2._ext[n]&&Utils.isFunction(M2D2._ext[n])){const e=M2D2._ext[n](s,t);e&&o._setValues(t,e,i)}else if("#"===n[0])o._doRender(Utils.node(n),s,i);else if(Utils.isArray(s)&&2===s.length&&"object"==typeof s[0]&&"string"==typeof s[1]){let e=s[0]._update||null;void 0===t._orig_update&&(t._orig_update=e,s[0]._update=function(){o._setValue(t,n,s[0][s[1]]),null!==t._orig_update&&t._orig_update()}),o._setValue(t,n,s[0][s[1]])}else if("text"===n&&null!==s)o._setValue(t,n,s);else if("dataset"===n&&Utils.isPlainObject(s))for(let e in s)t.setAttribute("data-"+e,s[e]);else if("style"===n)if(Utils.isPlainObject(s))for(const e in s)t.style[e]=s[e];else t.style=s;else if(n.startsWith("on")&&Utils.isFunction(s))i?(void 0===m2d2.f&&(m2d2.f=[]),m2d2.f.push(s),t.setAttribute(n,"m2d2.f["+(m2d2.f.length-1)+"](event)")):t[n]=s;else if(s instanceof Date)o._setValue(t,n,s);else if(!o._hasAttrOrProp(t,n)||Utils.isObject(s)||"id"===n&&Utils.isNumeric(s)){let e=Utils.node(n,t);if(!e&&(e=Utils.node("#"+n,t),e||(e=Utils.node("."+n,t)),!e)){const e=function(e,i,n){const s=Utils.newNode(e);t.append(s),o._doRender(s,i,n)};if(-1!==o._htmlGenTags.indexOf(n)){e(n,s,i);continue}if(s&&Utils.isObject(s)&&void 0!==s.tagName){let t=s.tagName;delete s.tagName,e(t,s,i);continue}}e?o._doRender(e,s,i):console.log("No child or attribute found for: "+n+" in element: "+t.localName)}else{try{t[n]=s}catch(e){console.log("Unable to set property ["+n+"] in element: "+t.localName+". Read-only?")}if("boolean"!=typeof t[n]&&o._hasAttr(t,n)&&t.setAttribute(n,s),"value"===n){let e=t.onchange||null;void 0===t._orig_change&&(t._orig_change=e,t.onchange=function(){this.setAttribute(n,this.value),null!==this._orig_change&&this._orig_change()})}void 0===t._mutable&&(new MutationObserver((function(t){const e=t[0].target;void 0!==e._m2d2?t.forEach((function(t){const n=t.attributeName;let s=e._m2d2[n];const l="boolean"==typeof s?e[n]:e.getAttribute(n);if(void 0!==s&&s!=l){e._m2d2[n]=l;let t={};t[n]=l,o._setValues(e,t,i),void 0!==e._m2d2._update&&e._m2d2._update()}})):console.log("BUG: Unable to find m2d2 reference in node.")})).observe(t,{attributes:!0}),t._mutable=!0)}}}else o._setValue(t,null,e)}_setValue(t,e,i){let o=!1;if(null==e?void 0===i||null==i?(console.log("Value was undefined in element :"),console.log(t)):Utils.isPlainObject(i)&&void 0!==i.text?i=i.text:!Utils.isNumeric(i)&&Utils.isHtml(i)&&(o=!0):"html"===e&&(o=!0),o)t.innerHTML=i;else if("value"===e||null==e&&this._hasProp(t,"value")&&"LI"!==t.tagName)this._hasProp(t,"checked")?!0===i||"true"===i||1===i?t.setAttribute("checked",!0):!1===i||"false"===i||0===i?t.setAttribute("checked",!1):t.value=i:i instanceof Date?t.valueAsDate=i:t.value=i;else if(t.childElementCount>0){for(let e in t.childNodes){const o=t.childNodes[e];if(3===o.nodeType)return void o.replaceWith(i)}t.innerHTML=t.innerHTML+i}else t.innerText=i}_hasAttrOrProp(t,e){return this._hasAttr(t,e)||this._hasProp(t,e)}_hasAttr(t,e){let i=!1;if(t&&!Utils.isNumeric(e))switch(e){case"checked":i=void 0!==t.type&&("radio"===t.type||"checkbox"===t.type);break;default:i=t.hasAttribute(e)}return i}_hasProp(t,e){let i=!1;return t&&!Utils.isNumeric(e)&&(i=void 0!==t[e]&&!t.hasAttribute(e)),i}_defineProp(t,e,i){Utils.isObject(t)&&void 0===t[e]&&(Object.defineProperty(t,e,{enumerable:!1,writable:!0}),t[e]=i)}_setNode(t,e){this._defineProp(e,"_node",t),this._defineProp(t,"_m2d2",e)}_proxy(t,e){this._defineProp(t,"_proxy",!0);const i={get:function(e,o,n){if("m2d2"===o||"_"===o[0])return e[o];{const s=Reflect.get(e,o,n),l=Object.getOwnPropertyDescriptor(e,o);if(l&&!l.writable&&!l.configurable)return s;try{return Utils.isArray(t)&&!Utils.isNumeric(o)?e[o]:new Proxy(e[o],i)}catch(t){return s}}},defineProperty:function(t,i,o){return e(t,i,o),Reflect.defineProperty(t,i,o)},deleteProperty:function(t,i){return e(t,i),Reflect.deleteProperty(t,i)},set:function(t,i,o){return t[i]=o,e(t,i,{value:o}),void 0!==t._update&&t._update(),!0}};return new Proxy(t,i)}set data(t){this._data=t,this.update(this._data)}get data(){return this._data}}const m2d2=function(t,e,i){const o={},n=typeof t;switch(n){case"string":if(void 0===e)return o.data=t,null;o.root=t,Utils.isArray(e)&&(e={items:e}),o.data=e,o.template=i;break;case"object":t instanceof Node&&(o.root=t,t=e);case"function":Utils.isArray(t)&&(e={items:t}),o.data=t,o.template=i;break;default:return console.log("First argument passed to m2d2, with value: ("+t+") is of unknown type: "+n),null}return new M2D2(o).get()};M2D2.extend({show:function(t,e){const i=function(){return getComputedStyle(e,null).display};if(t){if("none"===i())if(e.dataset._m2d2_display)e.style.display=e.dataset._m2d2_display;else if(e.style.removeProperty("display"),"none"===i()){const t=function(){const t=document.getElementsByTagName("body")[0],i=document.createElement("template"),o=document.createElement(e.tagName);i.appendChild(o),t.appendChild(i);const n=getComputedStyle(o,null).display;return i.remove(),n}();e.style.display=e.dataset.display||("none"!==t?t:"block")}}else{const t="none"!==e.style.display?e.style.display:i();"none"!==t&&(e.dataset._m2d2_display=t),e.style.display="none"}}}),M2D2.extend({color:function(t,e){e.style.color=t},bgcolor:function(t,e){e.style.backgroundColor=t},css:function(t,e){e.className=t},"-css":function(t,e){let i=Utils.isArray(t)?t:t.split(" ");for(let t in i)e.classList.remove(i[t])},"+css":function(t,e){let i=Utils.isArray(t)?t:t.split(" ");for(let t in i)e.classList.add(i[t])}});
function TimerSrc(e,t){let n,r,u,l,a={};a.interval=e,a.checker=50,a.status="init";let i=(new Date).getTime();return n=i-e,a.call=function(e){return t=e,a},a.nocall=function(){return t=null,a},a.exec=function(){return t&&t(),n=(new Date).getTime(),a},a.check=function(){return u&&u(),a},a.play=function(){return u=a.step,a.status="running",a},a.pause=function(){return u=null,a.status="paused",a},a.destroy=function(){for(var e in u=null,clearInterval(r),r=null,a)a[e]=null,delete a[e];a.status="destroyed"},a.step=function(){return i=(new Date).getTime(),l=Math.max(0,a.interval-(i-n)),0===l&&(l=a.interval,n=(new Date).getTime(),t&&t()),a},a.slow=function(){return a.interval=1e3,a},a.fast=function(){return a.interval=e,a},r=setInterval(a.check,a.checker),a}
class NdJsonPlayer{fps;loop;showfirst;autoplay;stream;path;playing=!1;loaded=!1;backwards=!1;started=!1;onStart;onLoad;onRender;onFinish;onError;player=null;canvas=null;ctx=null;timer=null;src="";frame=0;multiplier=1;_numFrames=0;_totTime=0;_frames=[];_frameBase="";_startTimeStamp=0;constructor(t,e,s,a,i,r,n,o){const h=this;h.src=t,window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame),h.onStart=a||function(){},h.onLoad=i||function(){},h.onRender=r||function(){},h.onFinish=n||function(){},h.onError=o||function(t){console.log(t)};let m=null;if(e instanceof Node)m=e;else{if("object"==typeof e)s=e,e="canvas";else if("string"!=typeof e)throw"Incorrect parameter passed to constructor of NdJsonPlayer";m=document.querySelector(e||"canvas")}if(!m)throw"Canvas element was not found in DOM: "+e;if("CANVAS"===m.tagName){h.canvas=m;const t=document.createElement("div");m.parentNode.insertBefore(t,m),t.prepend(m),m=t}else if(m.hasChildNodes()){if(h.canvas=m.querySelector("canvas"),!h.canvas)throw"No canvas found in element"}else h.canvas=document.createElement("CANVAS"),m.prepend(h.canvas);h.player=m,h.canvas.height=h.canvas.clientHeight,h.canvas.width=h.canvas.clientWidth,m.classList.add("ndjp"),h.ctx=h.canvas.getContext("2d"),h.fps=s.fps||24,h.loop=s.loop||!1,h.autoplay=s.autoplay||!1,h.stream=s.stream||!1,h.showfirst=!1!==s.showfirst,h.path=s.path||"",s.stream&&s.loop&&console.log("Warning: 'loop' and 'stream' are both set."),h.timer=new TimerSrc(1e3/h.fps),h.load((function(t){void 0!==t.w&&(h.canvas.width=t.w),void 0!==t.h&&(h.canvas.height=t.h),void 0!==t.fb&&(h._frameBase=t.fb),void 0!==t.tf&&(h._numFrames=t.tf),void 0!==t.tt&&(h._totTime=t.tt),void 0!==t.ts&&(h._startTimeStamp||(h._startTimeStamp=t.ts)),void 0!==t.fps&&(h.fps=t.fps,h.timer=new TimerSrc(1e3/h.fps)),void 0!==t.f?(h._frames.push(t),h.loaded||(h.loaded=!0,h.autoplay?h.play():h.showfirst&&h.step())):h.onRender(t),h.started||(h.onStart(h),h.started=!0)}))}load(t,e){void 0!==e&&(this.src=e,this._frames=[]);const s=new TextDecoder;return this._fetch(s,t)}_fetch(t,e){const s=this;let a="";return fetch(s.src).then(t=>t.body.getReader()).then(i=>i.read().then((function r({value:n,done:o}){if(o){if(!s.stream)return e(JSON.parse(a)),void s.onLoad(s);setTimeout((function(){s._fetch(t,e)}),s.fps?1e3/s.fps:0)}const h=(a+t.decode(n,{stream:!0})).split(/[\r\n](?=.)/);return a=h.pop(),h.map(JSON.parse).forEach(e),i.read().then(r)}))).catch(t=>this.onError(t))}_render(t){if(null==this.timer)throw"TimerSrc was not initialized";if(0===this._frames.length)throw"Video is empty or no frames were found";this.frame>=this._frames.length&&(this.frame=this.loop?0:this._frames.length-1),this.frame<0&&(this.frame=this.loop?this._frames.length-1:0),this._displayImg(t)}_displayImg(t){const e=this,s=e._frames[e.frame],a=function(){e.onRender(s),e.timer.call((function(){t||(e._increment(),e.timer.nocall()),e._displayImg()}))};if(void 0!==s.f){const t=e._frameBase+s.f;e._image(t,a)}else e.onRender(s),a()}_increment(){this.frame+=this.multiplier*(this.backwards?-1:1),this.frame<0&&(this.loop?this.frame=this._frames.length-1:(this.frame=0,this.pause(),this.onFinish(this))),this.frame>this._frames.length-1&&(this.loop?this.frame=0:(this.frame=this._frames.length-1,this.pause(),this.onFinish(this)))}_draw=function(t,e){const s=this;return 0===t.width&&0===t.height?(t.onerror(),void 0!==e&&e(!1)):(s.ctx.save(),s.ctx.drawImage(t,0,0,t.width,t.height,0,0,s.canvas.width,s.canvas.height),s.ctx.restore(),void 0!==e&&e(!0)),this};_image=function(t,e){const s=this,a=new Image;return a.crossOrigin="",a.onload=function(){s._draw(a,(function(t){t&&void 0!==e&&e(a)}))},a.onerror=function(){const t=s.onError();t&&(a.src=t)},a.src="/"===t[0]||t.match(/^https?:/)||t.match(/^data:image/)?t:s.path+t,this};frameBase(){return this._frameBase}currentFrame(){return this.frame}totalFrames(){return this._numFrames||this._frames.length}totalTime(){return this._totTime||this.currentFrame()/this.fps}frameAt(t){const e=this;let s=t<this.totalFrames()?e._frames[t]:null;return s&&(s.fb=e._frameBase),s}indexAt(t){return~~(t*this.totalFrames()/100)}playerNode(){return this.player}play(t){t<0||null==t?this.frame=0:t>this._frames.length?this.frame=this._frames.length-1:this.frame=1*t,this.playing=!0,this.timer.play(),this._render(!1)}playForward(t){this.backwards=!1,this.play(t)}playBackwards(t){this.backwards=!0,this.play(t)}pause(){this.playing=!1,this.timer.pause()}stop(){this.playing=!1,this.frame=0,this.timer.pause(),this._displayImg(!0)}step(t){t<0?t=0:t>this._frames.length?t=this._frames.length-1:void 0!==t&&(this.frame=1*t),this.playing=!1,this.timer.step(),this._render(!0)}stepForwards(){this.backwards=!1,this.step()}stepBackwards(){this.backwards=!0,this.step()}reset(){return void 0!==this.ctx.reset&&(this.ctx.reset(),this.ctx.clear(),this.stop(),this.canvas.width=this.canvas.width),this}}
class NDJPlayer{ndjp;options;ui;onAction;constructor(t,o,e,n){const s=this;this.options=Object.assign({controls:!1,resize:!0},e||{}),this.onAction=n||function(){},this._create(o),this.ndjp=new NdJsonPlayer(t,o,e,(function(t){s._adjustSize(),void 0!==s.options.onstart&&s.options.onstart(t)}),(function(t){void 0!==s.options.onload&&(s.options.onload(t),s.options.stream&&console.log("Warning: 'stream' is ON, so 'onload' event will never be fired."))}),(function(t){s._onUpdate(t),void 0!==s.options.onrender&&s.options.onrender(t)}),(function(t){}),(function(t){console.log(t)}))}_onUpdate(t){const o=this;if(void 0!==o.ui&&void 0!==o.ui.controls){if(void 0!==o.ui.controls.frames&&(o.ndjp.stream?o.ui.controls.frames.text=o.ndjp.currentFrame()+1:o.ui.controls.frames.text=o.ndjp.currentFrame()+1+"/"+o.ndjp.totalFrames()),void 0!==o.ui.controls.lapse){let e="";const n=o.ndjp._startTimeStamp&&void 0!==t.ts,s=void 0!==t.t,i=o.ndjp._totTime>0;t.d&&(e=t.d+" "),n?e+=o._formatMillis(t.ts-o.ndjp._startTimeStamp):s&&(e+=t.t.indexOf(":")>0?t.t:o._fmtTime(t.t)),i&&(e+="/"+o.ndjp.totalTime()),o.ui.controls.lapse.text=e}void 0!==o.ui.controls.progress&&(o.ui.controls.progress.value=(o.ndjp.currentFrame()+1)/o.ndjp.totalFrames()*100)}}_adjustSize(){if(this.options.resize){let t=this.ndjp.player,o=this.ndjp.player.parentElement;if(t.clientHeight>o.clientHeight){let e=this.ndjp.canvas.height/this.ndjp.canvas.width,n=1/e;this.ndjp.canvas.height=o.clientHeight-(this.options.controls?t.querySelector(".controls").clientHeight:0),this.ndjp.canvas.width=o.clientWidth*(e<1?e:n)}}}_create(t){this.ui=m2d2(t,this._getUI(t))}_getUI(t){const o=this;let e={html:t.innerHTML||""};const n={tagName:"a",className:"play",show:!0,title:"Play",text:"▶️",href:"#",onclick:function(){return o.onAction("play",o.ndjp,o),o.ndjp.play(),o.ui.controls.play.show=!1,o.ui.controls.pause.show=!0,!1}},s={tagName:"a",className:"pause",show:!1,title:"Pause",text:"⏸️",href:"#",onclick:function(){return o.onAction("pause",o.ndjp,o),o.ndjp.pause(),o.ui.controls.play.show=!0,o.ui.controls.pause.show=!1,!1}},i={tagName:"a",className:"stop",title:"Stop",text:"⏹️",href:"#",onclick:function(){return o.onAction("stop",o.ndjp,o),o.ndjp.stop(),!1}};document.addEventListener("fullscreenchange",t=>{const e=o.ndjp.player;document.fullscreenElement?e.classList.add("fullscreen"):e.classList.remove("fullscreen")});const l={tagName:"a",className:"fullscreen",title:"Full Screen",text:"⛶",href:"#",onclick:function(t){const e=o.ndjp.player;return e.classList.contains("fullscreen")?document.exitFullscreen():e.requestFullscreen(),!1}},a={tagName:"label",className:"lapse",show:!0,title:"Time elapsed / Time Total",text:"0:00"},c={tagName:"label",className:"frames",show:!0,title:"Current Frame / Total Frames",text:"0"},r={show:!0,value:0,max:100,onmousemove:function(t){let e=~~(t.offsetX/this.offsetWidth*100),n=o.ndjp.frameAt(o.ndjp.indexAt(e));if(n){o.ui.controls.thumb.show=!0,o.ui.controls.thumb.img.src=o.ndjp.frameBase()+(n.th||n.f),void 0!==n.tc&&(o.ui.controls.thumb.caption=n.tc);let e=o.ui.controls.thumb._node;e.style.left=this.offsetLeft+t.offsetX-e.clientWidth/2+"px"}else o.ui.controls.thumb.show=!1},onmouseleave:function(){o.ui.controls.thumb.show=!1},onclick:function(t){let e=~~(t.offsetX/this.offsetWidth*100),n=o.ndjp.indexAt(e);o.ndjp.step(n),o.onAction("progress",o.ndjp,o)}};if(this.options.controls){const t="full"===this.options.controls,o="common"===this.options.controls;e=this._getBasicUI(),e.controls.play=n,e.controls.pause=s,t&&(e.controls.stop=i),e.controls.lapse=a,e.controls.progress=r,(o||t)&&(e.controls.frames=c),t&&(e.controls.fullscreen=l)}this.options.controls;let p=t instanceof Node?t:document.querySelector(t);if(p){p.querySelector("canvas")||(e=Object.assign({canvas:""},e))}else console.log("Root element: "+t+" was not found in document"),e=Object.assign({canvas:""},e);return e}_getBasicUI(){return{caption:"",controls:{tagName:"div",className:"controls",thumb:{tagName:"figure",className:"thumb",show:!1,img:{src:""},caption:{tagName:"figCaption",className:"caption",show:!1}}}}}_fmtTime(t){let o=(t=t.toFixed(2)).split(".")[1]||"00";return(~~(t/60)+"").padStart(2,"0")+":"+(~~(t/60%1*60)+"").padStart(2,"0")+"."+o}_formatMillis(t){function o(t,o){return("00"+t).slice(-1*(o||2))}const e=Math.floor(t/1e3/60/60),n=Math.floor(60*(t/1e3/60/60-e)),s=Math.floor(60*(60*(t/1e3/60/60-e)-n)),i=parseInt(t%1e3/100);return o(e)+":"+o(n)+":"+o(s)+"."+o(i,3)}}
class VideoND extends HTMLElement{constructor(){super();const t={autoplay:!1,controls:!1,loop:!1,width:"auto",height:"auto",poster:"",preload:"auto",src:"",stream:!1,cc:"auto",caption:"",fullscreen:!1,fps:"",speed:!1,autosize:"auto",sizes:{}||[],thumbs:"auto"},o={};for(let n in t)o[n]=this.getAttribute(n)||this.hasAttribute(n)||t[n];o.onstart=function(t){n.onstart&&n.onstart(t)},o.onload=function(t){n.onload&&n.onload(t)},o.onrender=function(t){n.onrender&&n.onrender(t,e.ndjp,e,e.ndjp.canvas,e.ndjp.ctx)},this.style.display="block",this.className="ndjp",this._root=this;const n=this,e=new NDJPlayer(o.src,this,o,(function(t,o,e){n.onaction&&n.onaction(t,o,e)}))}setCaption(t){this._root.querySelector("caption").innerText=t}static get observedAttributes(){return["width","height","caption"]}attributeChangedCallback(t,o,n){"caption"===t&&this.setCaption(n)}}document.addEventListener("DOMContentLoaded",(function(){window.customElements.define("video-nd",VideoND)}));